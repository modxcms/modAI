!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.modAI=n():e.modAI=n()}(self,(()=>(()=>{"use strict";var e={d:(n,t)=>{for(var l in t)e.o(t,l)&&!e.o(n,l)&&Object.defineProperty(n,l,{enumerable:!0,get:t[l]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},n={};e.r(n),e.d(n,{chatHistory:()=>le,executor:()=>i,history:()=>a,ui:()=>Le,window:()=>Pe});const t={buffered:{chatgpt:{content:e=>{const n=e?.choices?.[0]?.message?.content;if(!n)throw new Error(_("modai.cmp.failed_request"));return{id:e.id,content:n}},image:e=>{let n=e?.data?.[0]?.url;if(!n){if(n=e?.data?.[0]?.b64_json,!n)throw new Error(_("modai.cmp.failed_request"));n=`data:image/png;base64,${n}`}return{id:`chatgpt-${Date.now()}-${Math.round(1e3*Math.random())}`,url:n}}},claude:{content:e=>{const n=e?.content?.[0]?.text;if(!n)throw new Error(_("modai.cmp.failed_request"));return{id:e.id,content:n}}},gemini:{content:e=>{const n=e?.candidates?.[0]?.content?.parts?.[0]?.text;if(!n)throw new Error(_("modai.cmp.failed_request"));return{id:`gemini-${Date.now()}-${Math.round(1e3*Math.random())}`,content:n}},image:e=>{const n=e?.predictions?.[0]?.bytesBase64Encoded;if(!n)throw new Error(_("modai.cmp.failed_request"));return{id:`gemini-${Date.now()}-${Math.round(1e3*Math.random())}`,url:`data:image/png;base64,${n}`}}}},stream:{chatgpt:{content:(e,n)=>{const t=n?.content??"",l=e.choices?.[0]?.delta?.content||"";return{...n,id:e.id,content:`${t}${l}`}}},claude:{content:(e,n)=>{const t=n?.content??"",l=e.delta?.text||"";return{...n,content:`${t}${l}`}}},gemini:{content:(e,n)=>{const t=n?.content??"",l=e.candidates?.[0]?.content?.parts?.[0]?.text||"";return{...n,content:`${t}${l}`}}}}},l=async e=>{if(!e.ok){const n=await e.json();if(n?.error)throw new Error(n.error.message);throw new Error(`${e.status} ${e.statusText}`)}},o=async(e,n,l,o,r)=>{if(!e.body)throw new Error("failed");const i=e.body.getReader(),d=new TextDecoder("utf-8");let a="",s={id:`${n}-${Date.now()}-${Math.round(1e3*Math.random())}`,content:""};for(;!r||!r.aborted;){const{done:e,value:r}=await i.read();if(e)break;const u=d.decode(r,{stream:!0});if("gemini"===n){const e=u.trim().split(",\r\n").map((e=>e.replace(/^\[|]$/g,""))).filter((e=>""!==e.trim()));for(const r of e)try{const e=JSON.parse(r);s=t.stream[n][l](e,s),o&&o(s)}catch{}}if("chatgpt"===n){a+=u;let e,r=0;for(;-1!==(e=a.indexOf("\n",r));){const i=a.slice(r,e).trim();if(r=e+1,i.startsWith("data: ")){const e=i.slice(6);if("[DONE]"===e)continue;try{const r=JSON.parse(e);s=t.stream[n][l](r,s),o&&o(s)}catch{}}}a=a.slice(r)}if("claude"===n){a+=u;let e,r=0;for(;-1!==(e=a.indexOf("\n",r));){const i=a.slice(r,e).trim();if(r=e+1,i.startsWith("data: ")){const e=i.slice(6);try{const r=JSON.parse(e);if("message_start"===r.type){s.id=r.message.id;continue}if("content_block_delta"!==r.type)continue;s=t.stream[n][l](r,s),o&&o(s)}catch{}}}a=a.slice(r)}}return s},r=async(e,n,r,i)=>{const d=(i=i||new AbortController).signal,a=await fetch(`${modAI.apiURL}?action=${e}`,{signal:d,method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});if(!a.ok){const e=await a.json();if(e.error)throw new Error(e.error.message);throw new Error(e.detail)}const s=a.headers.get("x-modai-service")??"chatgpt",u=a.headers.get("x-modai-parser")??"content",c=1===parseInt(a.headers.get("x-modai-stream")??"0");if(1!==parseInt(a.headers.get("x-modai-proxy")??"0")){return(async(e,n,r)=>{if("object"!=typeof e||!e.forExecutor)return e;const i=e.forExecutor,d=(r=r||new AbortController).signal;if(!i.service||!i.parser)throw new Error(_("modai.cmp.service_required"));if(!t[i.stream?"stream":"buffered"]?.[i.service]?.[i.parser])throw new Error(_("modai.cmp.service_unsupported"));if(i.stream)return(async e=>{if("content"!==i.parser)throw new Error(_("modai.cmp.service_unsupported"));const t=await fetch(e.url,{signal:d,method:"POST",body:e.body,headers:e.headers});return await l(t),o(t,i.service,i.parser,n)})(i);const a=await(async e=>{const n=await fetch(e.url,{signal:d,method:"POST",body:e.body,headers:e.headers});await l(n);const t=await n.json();if(t.error)throw new Error(t.error.message);return t})(i);return t.buffered[i.service][i.parser](a)})(await a.json(),r,i)}if(!s||!u)throw i.abort(),new Error(_("modai.cmp.service_required"));if(!t[c?"stream":"buffered"]?.[s]?.[u])throw i.abort(),new Error(_("modai.cmp.service_unsupported"));if(!c){const e=await a.json();return t.buffered[s][u](e)}if("content"!==u)throw new Error(_("modai.cmp.service_unsupported"));return await o(a,s,u,r,d)},i={mgr:{download:{image:async e=>await(async(e,n)=>{const t=await fetch(`${modAI.apiURL}?action=Download\\Image`,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}});if(!t.ok){const e=await t.json();if(e.error)throw new Error(e.error.message);throw new Error(e.detail)}return await t.json()})(0,e)},prompt:{freeText:async(e,n,t)=>r("Prompt\\FreeText",e,n,t),text:async(e,n,t)=>r("Prompt\\Text",e,n,t),vision:async(e,n,t)=>r("Prompt\\Vision",e,n,t),image:async(e,n)=>r("Prompt\\Image",e,void 0,n)}}},d={},a={_formatOutput(e,n){const t=d[e],l=t.visible>0,o=t.visible!==t.values.length-1;return{value:void 0!==n?n:t.values[t.visible]??null,nextStatus:o,prevStatus:l,current:t.visible+1,total:t.values.length,context:t.context}},insert(e,n,t=!1){const l=d[e];t||(l.visible=l.values.push(n)-1);const o=this._formatOutput(e,n);return"function"==typeof l.syncUI&&l.syncUI(o,t),o},next(e){const n=d[e];if(n.visible===n.values.length-1)return this._formatOutput(e);n.visible++;const t=this._formatOutput(e);return"function"==typeof n.syncUI&&n.syncUI(t),t},prev(e){const n=d[e];if(n.visible<=0)return this._formatOutput(e);n.visible--;const t=this._formatOutput(e);return"function"==typeof n.syncUI&&n.syncUI(t),t},init(e,n,t,l){return d[e]||(d[e]={visible:-1,values:[],context:l}),d[e].syncUI=n,t&&(d[e].values=[t],d[e].visible=0),{cachedItem:d[e],getData:()=>this._formatOutput(e),getAll:()=>d[e].values,syncUI:()=>{"function"==typeof d[e].syncUI&&d[e].syncUI(this._formatOutput(e),!1)},insert:(n,t=!1)=>this.insert(e,n,t),next:()=>this.next(e),prev:()=>this.prev(e)}}},s=(e,n)=>{if(!n.isDragging)return;const t=e.clientX-n.offsetX,l=e.clientY-n.offsetY;n.style.left=t+"px",n.style.top=l+"px",n.style.transform="none"},u=e=>{e.isDragging=!1,document.body.style.userSelect=""};var c,p={};function g(){if(c)return p;c=1,Object.defineProperty(p,"__esModule",{value:!0}),p.styleq=void 0;var e=new WeakMap;function n(n){var t,l,o;return null!=n&&(t=!0===n.disableCache,l=!0===n.disableMix,o=n.transform),function(){for(var n=[],r="",i=null,d="",a=t?null:e,s=new Array(arguments.length),u=0;u<arguments.length;u++)s[u]=arguments[u];for(;s.length>0;){var c=s.pop();if(null!=c&&!1!==c)if(Array.isArray(c))for(var p=0;p<c.length;p++)s.push(c[p]);else{var g=null!=o?o(c):c;if(null!=g.$$css){var b="";if(null!=a&&a.has(g)){var h=a.get(g);null!=h&&(b=h[0],d=h[2],n.push.apply(n,h[1]),a=h[3])}else{var m=[];for(var y in g){var x=g[y];if("$$css"!==y)"string"==typeof x||null===x?n.includes(y)||(n.push(y),null!=a&&m.push(y),"string"==typeof x&&(b+=b?" "+x:x)):console.error("styleq: ".concat(y," typeof ").concat(String(x),' is not "string" or "null".'));else{var f=g[y];!0!==f&&(d=d?f+"; "+d:f)}}if(null!=a){var v=new WeakMap;a.set(g,[b,m,d,v]),a=v}}b&&(r=r?b+" "+r:b)}else if(l)null==i&&(i={}),i=Object.assign({},g,i);else{var w=null;for(var S in g){var R=g[S];void 0!==R&&(n.includes(S)||(null!=R&&(null==i&&(i={}),null==w&&(w={}),w[S]=R),n.push(S),a=null))}null!=w&&(i=Object.assign(w,i))}}}return[r,i,d]}}return(p.styleq=n()).factory=n,p}var b=g();const h=e=>new Error(`Unexpected 'stylex.${e}' call at runtime. Styles must be compiled by '@stylexjs/babel-plugin'.`),m=e=>h(`types.${e}`);function y(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];const[l,o,r]=b.styleq(n),i={};return null!=l&&""!==l&&(i.className=l),null!=o&&Object.keys(o).length>0&&(i.style=o),null!=r&&""!==r&&(i["data-style-src"]=r),i}const x={angle:e=>{throw m("angle")},color:e=>{throw m("color")},url:e=>{throw m("url")},image:e=>{throw m("image")},integer:e=>{throw m("integer")},lengthPercentage:e=>{throw m("lengthPercentage")},length:e=>{throw m("length")},percentage:e=>{throw m("percentage")},number:e=>{throw m("number")},resolution:e=>{throw m("resolution")},time:e=>{throw m("time")},transformFunction:e=>{throw m("transformFunction")},transformList:e=>{throw m("transformList")}};function f(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];const[l]=b.styleq(n);return l}f.attrs=function(){const{className:e,"data-style-src":n,style:t}=y(...arguments),l={};return null!=e&&""!==e&&(l.class=e),null!=t&&Object.keys(t).length>0&&(l.style=Object.keys(t).map((e=>`${e}:${t[e]};`)).join("")),null!=n&&""!==n&&(l["data-style-src"]=n),l},f.create=function(e){throw h("create")},f.createTheme=(e,n)=>{throw h("createTheme")},f.defineVars=function(e){throw h("defineVars")},f.firstThatWorks=function(){throw h("firstThatWorks")},f.keyframes=e=>{throw h("keyframes")},f.props=y,f.types=x;const v={margin:"x1ghz6dp",marginInline:null,marginInlineStart:null,marginLeft:null,marginInlineEnd:null,marginRight:null,marginBlock:null,marginTop:null,marginBottom:null,padding:"x1717udv",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,boxSizing:"x9f619",fontFamily:"xmy0v6l",$$css:!0},w=(e,n)=>{Object.assign(e,y(v,n))},S=(e,n,t)=>{const l="string"==typeof t?t:"";t&&"string"!=typeof t&&!Array.isArray(t)&&(t=[t]);const o=document.createElement(e);return n&&Object.assign(o,y(n)),l?o.textContent=l:t&&Array.isArray(t)&&t.forEach((e=>{"string"==typeof e?o.append(document.createTextNode(e)):o.append(e)})),o},R=e=>/<[^>]*>/g.test(e)?e:e.replace(/\r\n|\n|\r/g,"<br>"),k=(e,n,t,l)=>{const o="string"==typeof e?e:"";"string"==typeof e||Array.isArray(e)||(e=[e]);const r=S("button",t,o);return r.type="button",Array.isArray(e)&&e.forEach((e=>{"string"==typeof e?r.append(document.createTextNode(e)):r.append(e)})),r.addEventListener("click",n),r.enable=()=>{r.disabled=!1},r.disable=()=>{r.disabled=!0},l&&Object.assign(r,l),r},C={loadingText:"Loading...",completedText:"Completed!",completedTextDuration:2e3,disabled:!1},E={actionButton:{backgroundColor:"x83z2og",border:"x1nfl404",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,padding:"xpb1vv",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,fontSize:"xfifm61",cursor:"x1ypdohk",display:"x78zum5",alignItems:"x6s0dn4",color:"xn0hivg",opacity:"x1hc1fzr",":disabled_opacity":"xijokvz",":disabled_cursor":"x1s07b3s",$$css:!0},icon:{display:"x1rg5ohu",width:"x6jxa94",height:"x1v9usgg",marginRight:"x17ituo4",marginInlineStart:null,marginInlineEnd:null,backgroundSize:"x1tbiz1a",backgroundRepeat:"xiy17q3",backgroundPosition:"x1xsqp64",backgroundPositionX:null,backgroundPositionY:null,$$css:!0}},I={copy:{backgroundImage:"xsidlj1",$$css:!0},insert:{backgroundImage:"xgxuiq8",$$css:!0}},T={spinner:{display:"x1rg5ohu",marginRight:"x17ituo4",marginInlineStart:null,marginInlineEnd:null,width:"xsmyaan",height:"x1kpxq89",position:"x1n2onr6",animationName:"x1aerksh",animationDuration:"x1q3qbx4",animationTimingFunction:"x1esw782",animationIterationCount:"xa4qsjk",$$css:!0},dot:{position:"x10l6tqk",width:"x1g8rjiy",height:"xuoj239",backgroundColor:"xtwfq29",borderRadius:"x16rqkct",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,$$css:!0},top:{top:"x13vifvy",left:"x1nrll8i",insetInlineStart:null,insetInlineEnd:null,transform:"x1nc5ocm",$$css:!0},right:{top:"xwa60dl",right:"x3m8u43",insetInlineStart:null,insetInlineEnd:null,transform:"x1cdci3v",$$css:!0},bottom:{bottom:"x1ey2m1c",left:"x1nrll8i",insetInlineStart:null,insetInlineEnd:null,transform:"x1nc5ocm",$$css:!0},left:{top:"xwa60dl",left:"xu96u03",insetInlineStart:null,insetInlineEnd:null,transform:"x1cdci3v",$$css:!0}},B=e=>{e={...C,...e};const n=k([S("span",[E.icon,I[e.icon]]),e.label],(async()=>{const t=n.innerHTML,l=e.onClick(e.message,e.modal);if(l instanceof Promise){const t=S("span",T.spinner,[S("span",[T.dot,T.top]),S("span",[T.dot,T.right]),S("span",[T.dot,T.bottom]),S("span",[T.dot,T.left])]);n.innerHTML=S("span",void 0,[t,e.loadingText||""]).outerHTML,await l}n.innerHTML=`\n                <span style="margin-right: 5px;">✓</span>\n                ${e.completedText}\n            `,await new Promise((e=>setTimeout(e,2e3))),n.innerHTML=t}),E.actionButton);return n.classList.add("action-button"),e.disabled&&n.disable(),n},$={width:"xh8yej3",border:"x1gs6z28",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,backgroundColor:"xyt46ls",maxWidth:"x193iq5w",boxSizing:"x9f619",$$css:!0},L={display:"x78zum5",flexDirection:"xdt5ytf",gap:"x167g77z",rowGap:null,columnGap:null,$$css:!0},j={display:"x78zum5",flexDirection:"x1q0g3np",gap:"x167g77z",rowGap:null,columnGap:null,flexWrap:"x1a02dak",$$css:!0},W={width:"x1exxlbk",height:"xpyat2d",borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,overflow:"xb3r6kr",overflowX:null,overflowY:null,marginTop:"x1gslohp",$$css:!0},z={width:"xh8yej3",height:"x5yr21d",objectFit:"xl1xv1r",$$css:!0},M={fontSize:"xif65rj",marginBottom:"xieb3on",borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,position:"x1n2onr6",wordWrap:"x1vvkbs",width:"xh8yej3",boxSizing:"x9f619",$$css:!0},q={width:"xh8yej3",backgroundColor:"xyt46ls",boxShadow:"xxo6qbs",borderTopLeftRadius:"x1nrfd8m",borderStartStartRadius:null,borderStartEndRadius:null,$$css:!0},A={width:"xeq5yr9",padding:"xetlade",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,backgroundColor:"xkip32",color:"x1awj2ng",marginLeft:"x8x9d4c",marginInlineStart:null,marginInlineEnd:null,borderTopRightRadius:"x16gx4na",borderStartStartRadius:null,borderStartEndRadius:null,$$css:!0},D={width:"xeq5yr9",padding:"xetlade",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,backgroundColor:"x23e8kh",color:"x1awj2ng",marginLeft:"x8x9d4c",marginInlineStart:null,marginInlineEnd:null,borderBottomRightRadius:"x1w61mk2",borderEndStartRadius:null,borderEndEndRadius:null,display:"x78zum5",alignItems:"x6s0dn4",gap:"x167g77z",rowGap:null,columnGap:null,$$css:!0},O={width:"x1kky2od",height:"xlup9mm",backgroundImage:"xrcfyjq",backgroundSize:"x1tbiz1a",backgroundRepeat:"xiy17q3",backgroundPosition:"x1xsqp64",backgroundPositionX:null,backgroundPositionY:null,$$css:!0},P={padding:"xc7ga6q",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,width:"xh8yej3",maxWidth:"x193iq5w",overflow:"xb3r6kr",overflowX:null,overflowY:null,boxSizing:"x9f619",$$css:!0},F={display:"x78zum5",padding:"x153ncpu",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,gap:"x167g77z",rowGap:null,columnGap:null,backgroundColor:"xyt46ls",borderRadius:"x1ucx3is",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,$$css:!0},H=(e,n)=>{"none"===e.chatMessages.style.display&&(e.chatMessages.style.display="block");const t=S("div",{...M,...D}),l=S("span",O);t.appendChild(l);const o=S("span");return o.textContent=n,t.appendChild(o),e.chatMessages.appendChild(t),e.chatMessages.scrollTop=e.chatMessages.scrollHeight,t},G=(e,n,t,l)=>{"none"===e.chatMessages.style.display&&(e.chatMessages.style.display="block");const o=S("div",{...M,...q}),r=l||"msg-"+Date.now(),d=S("div",P),a=((e,n,t=[])=>{const l=R(e);let o=!1,r=null;const i=S("iframe",$),d=()=>i.contentDocument||i.contentWindow?.document,a=e=>`\n        <html>\n        <head>\n            <style>\n            html {\n                width: 100%;\n                max-width: 100%;\n                padding: 0;\n                margin: 0;\n            }\n            body {\n                background-color: #efefee;\n                margin: 0;\n                padding: 0;\n                font-family: Arial, sans-serif;\n                overflow-x: hidden;\n                width: 100%;\n                max-width: 100%;\n                box-sizing: border-box;\n            }\n            * {\n                box-sizing: border-box;\n                max-width: 100%;\n            }\n            pre {\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                overflow-wrap: break-word;\n                max-width: 100%;\n                padding: 12px;\n                margin: 0;\n                background-color: #f5f7fa;\n                border-radius: 5px;\n                font-size: 14px;\n            }\n            img {\n                max-width: 100%;\n                height: auto;\n                display: block;\n            }\n            code {\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                max-width: 100%;\n                display: block;\n                overflow-x: hidden;\n                font-size: 14px;\n            }\n            table {\n                width: 100%;\n                max-width: 100%;\n                overflow-x: hidden;\n                display: block;\n                border-collapse: collapse;\n            }\n            div {\n                max-width: 100%;\n                overflow-wrap: break-word;\n                word-wrap: break-word;\n                box-sizing: border-box;\n            }\n            p {\n                margin: 0 0 0.5em 0;\n                max-width: 100%;\n            }\n            h1, h2, h3, h4, h5, h6 {\n                margin: 0 0 0.1em 0;\n                max-width: 100%;\n            }\n        </style>\n            ${t.map((e=>`<link rel="stylesheet" type="text/css" href="${e}" />`)).join("")}\n        </head>\n        <body style="padding: 0; max-width: 100%; width: 100%; box-sizing: border-box;">${e}</body>\n        </html>\n    `,s=(e,n)=>{const l=e.createElement("style");l.textContent="\n            html {\n                width: 100%;\n                max-width: 100%;\n                padding: 0;\n                margin: 0;\n            }\n            body {\n                background-color: #efefee;\n                margin: 0;\n                padding: 0;\n                font-family: Arial, sans-serif;\n                overflow-x: hidden;\n                width: 100%;\n                max-width: 100%;\n                box-sizing: border-box;\n            }\n            * {\n                box-sizing: border-box;\n                max-width: 100%;\n            }\n            pre {\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                overflow-wrap: break-word;\n                max-width: 100%;\n                padding: 12px;\n                margin: 0;\n                background-color: #f5f7fa;\n                border-radius: 5px;\n                font-size: 14px;\n            }\n            img {\n                max-width: 100%;\n                height: auto;\n                display: block;\n            }\n            code {\n                white-space: pre-wrap;\n                word-wrap: break-word;\n                max-width: 100%;\n                display: block;\n                overflow-x: hidden;\n                font-size: 14px;\n            }\n            table {\n                width: 100%;\n                max-width: 100%;\n                overflow-x: hidden;\n                display: block;\n                border-collapse: collapse;\n            }\n            div {\n                max-width: 100%;\n                overflow-wrap: break-word;\n                word-wrap: break-word;\n                box-sizing: border-box;\n            }\n            p {\n                margin: 0 0 0.5em 0;\n                max-width: 100%;\n            }\n            h1, h2, h3, h4, h5, h6 {\n                margin: 0 0 0.1em 0;\n                max-width: 100%;\n            }\n        ",e.head.appendChild(l),t.forEach((n=>{const t=e.createElement("link");t.rel="stylesheet",t.type="text/css",t.href=n,e.head.appendChild(t)})),e.body.innerHTML=n,e.body.style.padding="0",e.body.style.maxWidth="100%",e.body.style.width="100%",e.body.style.boxSizing="border-box"};return i.syncContent=e=>{(e=>{if(!o)return r=e,void(i.srcdoc=a(e));const n=d();if(!n)return r=e,void(i.srcdoc=a(e));n.head.querySelector("style")?n.body.innerHTML=e:s(n,e),i.syncHeight()})(e)},i.syncHeight=()=>{const e=i.contentWindow?.document.body;if(!e)return;const t=e.getElementsByTagName("*");let l=e.offsetHeight;for(let e=0;e<t.length;e++){const n=t[e],o=n.offsetTop+n.offsetHeight;l=Math.max(l,o)}i.style.height=l+5+"px",e.style.overflow="hidden",n.chatMessages.scrollTop=n.chatMessages.scrollHeight},i.onload=()=>{if(o=!0,null!==r){const e=r;r=null;const n=d();n&&(s(n,e),i.syncHeight())}i.syncHeight()},i.srcdoc=a(l),i})(Array.isArray(n)?n[0].value:n,e,t.customCSS??[]);d.appendChild(a);const s=S("div",F),u=e.history.getMessages().find((e=>e.id===r&&"assistant"===e.role));if(u&&("text"===t.type&&(!1!==t.textActions?.copy&&s.append(B({message:u,modal:e,disabled:e.isLoading,icon:"copy",label:"Copy",completedText:"Copied!",onClick:"function"==typeof t.textActions?.copy?t.textActions.copy:U})),"function"==typeof t.textActions?.insert&&s.append(B({message:u,modal:e,disabled:e.isLoading,icon:"insert",label:"Insert",completedText:"Inserted!",onClick:t.textActions.insert}))),"image"===t.type)){!1!==t.imageActions?.copy&&s.append(B({message:u,modal:e,disabled:e.isLoading,icon:"copy",label:"Copy",loadingText:"Downloading...",completedText:"Copied!",onClick:async(e,n)=>{const l="function"==typeof t.textActions?.copy?t.textActions.copy:U;if(!0===e.ctx.downloaded)return void l(e,n);const o=await i.mgr.download.image({url:e.content,field:t.field,namespace:t.namespace,resource:t.resource,mediaSource:t.image?.mediaSource});e.content=o.fullUrl,e.ctx.downloaded=!0,e.ctx.url=o.url,e.ctx.fullUrl=o.fullUrl,l(e,n)}}));const n=t.imageActions?.insert;"function"==typeof n&&s.append(B({message:u,modal:e,disabled:e.isLoading,icon:"insert",label:"Insert",completedText:"Inserted!",loadingText:"Downloading...",onClick:async(e,l)=>{if(!0===e.ctx.downloaded)return void n(e,l);const o=await i.mgr.download.image({url:e.content,field:t.field,namespace:t.namespace,resource:t.resource,mediaSource:t.image?.mediaSource});e.content=o.fullUrl,e.ctx.downloaded=!0,e.ctx.url=o.url,e.ctx.fullUrl=o.fullUrl,n(e,l)}}))}return o.append(d,s),e.chatMessages.appendChild(o),e.chatMessages.scrollTop=e.chatMessages.scrollHeight,o.update=e=>{const n=Array.isArray(e.content)?e.content[0].value:e.content,t="image"===e.type?`<img src="${n}" />`:R(n);a.syncContent(t),a.syncHeight()},o},N=(e,n,t)=>{if(!e.hidden)return"user"===e.role?((e,n)=>{"none"===e.chatMessages.style.display&&(e.chatMessages.style.display="block");const t=S("div",{...M,...A});let l,o=null;if(Array.isArray(n)){const[e,...t]=n;l=e.value,o=t}else l=n;const r=S("div",L),i=S("div");if(i.innerHTML=R(l),r.appendChild(i),o){const e=S("div",j);for(const n of o){const t=S("div",W),l=S("img",z);l.src=n.value,t.appendChild(l),e.appendChild(t)}r.appendChild(e)}return t.appendChild(r),t.update=e=>{const n=Array.isArray(e.content)?e.content[0].value:e.content;i.innerHTML=R(n)},e.chatMessages.appendChild(t),e.chatMessages.scrollTop=e.chatMessages.scrollHeight,t})(n,e.content):"image"===e.type?G(n,`<img src="${e.content}" />`,t,e.id):G(n,e.content,t,e.id)},U=async(e,n)=>{const t=Array.isArray(e.content)?e.content[0].value:e.content;if(navigator.clipboard&&navigator.clipboard.writeText)try{await navigator.clipboard.writeText(t)}catch{H(n,_("modai.cmp.failed_copy"))}else try{const e=S("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}catch{H(n,_("modai.cmp.failed_copy"))}},Y={modalOpen:!1},X={position:"x10l6tqk",top:"x1jzctok",left:"x1rvfpmx",insetInlineStart:null,insetInlineEnd:null,width:"x1hetxy2",height:"xvt47uu",borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,overflow:"xb3r6kr",overflowX:null,overflowY:null,border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,backgroundColor:"xt040g",cursor:"x1ypdohk",transition:"x1jaox4c",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":hover_transform":"x14snt5h",$$css:!0},V={width:"xh8yej3",height:"x5yr21d",objectFit:"xl1xv1r",$$css:!0},J={position:"x10l6tqk",top:"x13vifvy",left:"xu96u03",insetInlineStart:null,insetInlineEnd:null,width:"xh8yej3",height:"x5yr21d",backgroundColor:"xcpsgoo",color:"x1awj2ng",display:"x78zum5",alignItems:"x6s0dn4",justifyContent:"xl56j7k",fontSize:"x1pvqxga",cursor:"x1ypdohk",opacity:"xg01cxk",transition:"xzdg38j",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":hover_opacity":"x1o7uuvo",$$css:!0},K=(e,n)=>{e.isLoading=n,e.loadingIndicator.style.display=n?"flex":"none",e.messageInput.disabled=n,n?(e.clearChatBtn.disable(),e.sendBtn.disable(),e.stopBtn.enable()):(e.clearChatBtn.enable(),e.sendBtn.enable(),e.stopBtn.disable());const t=e.history.getMessages().length>0;n||!t?e.tryAgainBtn.disable():e.tryAgainBtn.enable(),Object.values(e.typeButtons).forEach((e=>{e.disabled=n})),e.chatMessages.querySelectorAll(".action-button").forEach((e=>{n?e.disable?.():e?.enable?.()}))},Q=e=>{e.imagePreview&&(e.imagePreview.remove(),e.imagePreview=void 0),e.uploadedImage=void 0,e.messageInput.style.paddingLeft="15px"},Z=async(e,n,t=!1)=>{if(!t&&n instanceof File&&!n.type.startsWith("image/"))return void H(e,"Only image files are allowed");e.uploadedImage&&Q(e);const l=S("div",X),o=S("img",V),r=S("button",J,"×");if(t)o.src=n,e.uploadedImage=o.src;else{const t=await new Promise(((e,t)=>{const l=new FileReader;l.onload=function(n){e(n.target?.result)},l.onerror=function(e){t(e)},l.readAsDataURL(n)}));o.src=t,e.uploadedImage=t}r.addEventListener("click",(n=>{n.stopPropagation(),Q(e)})),l.append(o,r),e.imagePreview=l,e.messageInput.style.paddingLeft="85px",e.inputWrapper.append(l)},ee={},ne="assistant",te=(e,n,t,l,o=!1,r="text")=>{const i=ee[e];if(!i)return;const d={content:n,role:t,id:l,hidden:o,type:r,ctx:{}},a=i.history.push(d)-1;l&&(i.idRef[l]=i.history[a]),d.el=i.onAddMessage(d)},le={init:(e,n)=>(ee[e]||(ee[e]={history:[],idRef:{},onAddMessage:n}),ee[e].onAddMessage=n,{addUserMessage:(n,t,l,o="text")=>{te(e,n,"user",t,l,o)},addAssistantMessage:(n,t,l="text")=>{te(e,n,ne,t,!1,l)},updateAssistantMessage:(n,t,l="text")=>{((e,n,t,l="text")=>{const o=ee[e];if(!o)return;if(!o.idRef[n])return void te(e,t,ne,n,!1,l);const r=o.idRef[n];r.content=t,r.el&&r.el.update&&r.el.update(r)})(e,n,t,l)},getAssistantMessage:n=>((e,n)=>{const t=ee[e];if(t)return t.idRef[n]})(e,n),getMessages:()=>ee[e].history,getMessagesHistory:()=>ee[e].history.map((e=>({role:e.role,content:e.content}))),clearHistory:()=>{ee[e].history=[]}})},oe=e=>{document.removeEventListener("mousemove",(n=>s(n,e))),document.removeEventListener("mouseup",(()=>u(e))),e.modalOverlay&&e.modalOverlay.remove(),e&&e.remove(),Y.modalOpen=!1},re=async(e,n,t,l)=>{const o=t?t.trim():e.messageInput.value.trim();if(!o||e.isLoading)return;K(e,!0),e.messageInput.value="",e.abortController=new AbortController;let r=o;e.uploadedImage&&"text"===n.type&&(r=[{type:"text",value:o},{type:"image",value:e.uploadedImage}]),Q(e);const d=e.history.getMessagesHistory(),a="user-msg-"+Date.now()+Math.round(1e3*Math.random());e.history.addUserMessage(r,a,l);try{if("text"===n.type){const t=await i.mgr.prompt.freeText({namespace:n.namespace,context:n.context,prompt:r,field:n.field||"",messages:d},(n=>{e.history.updateAssistantMessage(n.id,n.content)}),e.abortController);e.history.updateAssistantMessage(t.id,t.content)}if("image"===n.type){const n=await i.mgr.prompt.image({prompt:r},e.abortController);e.history.addAssistantMessage(n.url,n.id,"image")}e.abortController=void 0}catch(n){if(n instanceof Error){if("AbortError"===n.name)return;return void H(e,n.message)}H(e,"Unknown error")}K(e,!1)},ie={button:{backgroundColor:"x12peec7",border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,padding:"xk61eof",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,cursor:"x1ypdohk",display:"x78zum5",alignItems:"x6s0dn4",justifyContent:"xl56j7k",transition:"x169l3ba",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,opacity:"x1hc1fzr",justifyItems:"x1o2pa38",":disabled_opacity":"xijokvz",":disabled_cursor":"x1s07b3s",$$css:!0},modalFooter:{padding:"x1rytaw",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,display:"x78zum5",alignItems:"x6s0dn4",gap:"x883omv",rowGap:null,columnGap:null,backgroundColor:"x12peec7",justifyContent:"x1qughib",$$css:!0},typeSelector:{display:"x78zum5",alignItems:"x6s0dn4",gap:"x883omv",rowGap:null,columnGap:null,$$css:!0},typeLabel:{fontSize:"xif65rj",color:"xn0hivg",fontWeight:"xk50ysn",$$css:!0},typeToggleGroup:{display:"x78zum5",gap:"x1jnr06f",rowGap:null,columnGap:null,$$css:!0},typeToggleButton:{margin:"x1ghz6dp",marginInline:null,marginInlineStart:null,marginLeft:null,marginInlineEnd:null,marginRight:null,marginBlock:null,marginTop:null,marginBottom:null,padding:"x1arfzav",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,fontSize:"x4z9k3i",border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,backgroundColor:"x83z2og",color:"xn0hivg",cursor:"x1ypdohk",transition:"x169l3ba",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,opacity:"x1hc1fzr",":disabled_opacity":"xijokvz",":disabled_cursor":"x1s07b3s",$$css:!0},typeToggleButtonActive:{backgroundColor:"x1kvm9do",color:"xfungia",borderColor:"xiozw1c",borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,cursor:"xt0e3qv",":disabled_opacity":"x1fzehxr",":disabled_cursor":"x1s07b3s",$$css:!0}},de={display:"x78zum5",flexDirection:"xdt5ytf",gap:"x1jnr06f",rowGap:null,columnGap:null,width:"x1exxlbk",$$css:!0},ae={display:"x78zum5",gap:"x1jnr06f",rowGap:null,columnGap:null,justifyContent:"x1qughib",$$css:!0},se={backgroundColor:"xjbqb8w",border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,width:"x1useyqa",height:"x10w6t97",padding:"x1717udv",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,cursor:"x1ypdohk",display:"x78zum5",alignItems:"x6s0dn4",justifyContent:"xl56j7k",transition:"x169l3ba",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,opacity:"x1hc1fzr",":disabled_opacity":"xijokvz",":disabled_cursor":"x1s07b3s",$$css:!0},ue={backgroundColor:"xxzi0tn",color:"x1awj2ng",border:"x1gs6z28",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,padding:"x1ff1495",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,cursor:"x1ypdohk",fontWeight:"x117nqv4",height:"x1vqgdyp",minWidth:"xktpd3l",fontSize:"xif65rj",display:"x78zum5",alignItems:"x6s0dn4",justifyContent:"xl56j7k",gap:"x17d4w8g",rowGap:null,columnGap:null,opacity:"x1hc1fzr",transition:"x5gkzjs",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,":disabled_opacity":"xijokvz",":disabled_cursor":"x1s07b3s",$$css:!0},ce={width:"x1kky2od",height:"xlup9mm",backgroundImage:"x19cu162",backgroundSize:"x1tbiz1a",backgroundRepeat:"xiy17q3",backgroundPosition:"x1xsqp64",backgroundPositionX:null,backgroundPositionY:null,$$css:!0},pe={width:"x1kky2od",height:"xlup9mm",backgroundImage:"xjppt3x",backgroundSize:"x1tbiz1a",backgroundRepeat:"xiy17q3",backgroundPosition:"x1xsqp64",backgroundPositionX:null,backgroundPositionY:null,$$css:!0},ge={width:"x1kky2od",height:"xlup9mm",backgroundImage:"xxc1m8d",backgroundSize:"x1tbiz1a",backgroundRepeat:"xiy17q3",backgroundPosition:"x1xsqp64",backgroundPositionX:null,backgroundPositionY:null,$$css:!0},be={flex:"x98rzlu",flexGrow:null,flexShrink:null,flexBasis:null,position:"x1n2onr6",minHeight:"x1wxaq2x",maxHeight:"x1aoj0v",display:"x78zum5",$$css:!0},he={width:"xh8yej3",padding:"x1sj8shu",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,outline:"x1a2a7pz",outlineColor:null,outlineOffset:null,outlineStyle:null,outlineWidth:null,fontSize:"xif65rj",resize:"xtt52l0",minHeight:"x1wxaq2x",maxHeight:"x1aoj0v",overflowY:"x1odjw0f",backgroundColor:"x83z2og",cursor:"xmper1u",":disabled_backgroundColor":"xzk1692",":disabled_cursor":"x1s07b3s",$$css:!0},me={display:"x1s85apg",position:"x10l6tqk",top:"x13vifvy",left:"xu96u03",insetInlineStart:null,insetInlineEnd:null,width:"xh8yej3",height:"x5yr21d",backgroundColor:"x1dqo6ux",borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,color:"xtbymah",fontSize:"xif65rj",alignItems:"x6s0dn4",justifyContent:"xl56j7k",gap:"x1jnr06f",rowGap:null,columnGap:null,flexDirection:"x1q0g3np",zIndex:"x1n327nk",backdropFilter:"x19z9ohp",border:"x6oqggz",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,pointerEvents:"x47corl",$$css:!0},ye={display:"x78zum5",gap:"x1jnr06f",rowGap:null,columnGap:null,padding:"x1ff1495",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,backgroundColor:"x11gdpij",borderRadius:"xgqmno8",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,$$css:!0},xe={width:"x1xc55vz",height:"xdk7pt",backgroundColor:"x14byl53",borderRadius:"x16rqkct",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,display:"x1rg5ohu",animationName:"xuqynxq",animationDuration:"x1sbju2s",animationIterationCount:"xa4qsjk",animationTimingFunction:"x4hg4is",animationFillMode:"x1u6ievf",":nth-child(1)_animationDelay":"xvosfse",":nth-child(2)_animationDelay":"x1lle0v0",":nth-child(3)_animationDelay":"xrpfj4q",$$css:!0},fe={position:"xixxii4",top:"x13vifvy",left:"xu96u03",insetInlineStart:null,insetInlineEnd:null,width:"xh8yej3",height:"x5yr21d",backgroundColor:"xj4c5ne",display:"x1s85apg",zIndex:"x11uqc5h",$$css:!0},ve={position:"xixxii4",width:"x1p2m28r",minHeight:"x2lklch",maxHeight:"x9ybwvh",backgroundColor:"x83z2og",borderRadius:"x1sxf85j",borderStartStartRadius:null,borderStartEndRadius:null,borderEndStartRadius:null,borderEndEndRadius:null,borderTopLeftRadius:null,borderTopRightRadius:null,borderBottomLeftRadius:null,borderBottomRightRadius:null,boxShadow:"x1f5l6gq",display:"x1s85apg",flexDirection:"xdt5ytf",overflow:"xb3r6kr",overflowX:null,overflowY:null,zIndex:"x1rozsjd",top:"xwa60dl",left:"x1nrll8i",insetInlineStart:null,insetInlineEnd:null,transform:"x11lhmoz",transition:"xcrclan",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,$$css:!0},we={backgroundColor:"x12peec7",color:"x1mqxbix",padding:"x6w2896",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,display:"x78zum5",justifyContent:"x1qughib",alignItems:"x6s0dn4",cursor:"xv5twrn",$$css:!0},Se={color:"xn0hivg",fontWeight:"x117nqv4",fontSize:"x1j61zf2",$$css:!0},Re={display:"x78zum5",gap:"x883omv",rowGap:null,columnGap:null,$$css:!0},ke={background:"x11g6tue",backgroundAttachment:null,backgroundClip:null,backgroundColor:null,backgroundImage:null,backgroundOrigin:null,backgroundPosition:null,backgroundPositionX:null,backgroundPositionY:null,backgroundRepeat:null,backgroundSize:null,border:"x1gs6z28",borderWidth:null,borderInlineWidth:null,borderInlineStartWidth:null,borderLeftWidth:null,borderInlineEndWidth:null,borderRightWidth:null,borderBlockWidth:null,borderTopWidth:null,borderBottomWidth:null,borderStyle:null,borderInlineStyle:null,borderInlineStartStyle:null,borderLeftStyle:null,borderInlineEndStyle:null,borderRightStyle:null,borderBlockStyle:null,borderTopStyle:null,borderBottomStyle:null,borderColor:null,borderInlineColor:null,borderInlineStartColor:null,borderLeftColor:null,borderInlineEndColor:null,borderRightColor:null,borderBlockColor:null,borderTopColor:null,borderBottomColor:null,color:"xn0hivg",fontSize:"x1j61zf2",cursor:"x1ypdohk",transition:"xzdg38j",transitionBehavior:null,transitionDelay:null,transitionDuration:null,transitionProperty:null,transitionTimingFunction:null,$$css:!0},Ce={flex:"x98rzlu",flexGrow:null,flexShrink:null,flexBasis:null,padding:"x6w2896",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,overflowY:"x1odjw0f",width:"xh8yej3",boxSizing:"x9f619",display:"x1s85apg",$$css:!0},Ee={display:"x78zum5",padding:"x6w2896",paddingInline:null,paddingStart:null,paddingLeft:null,paddingEnd:null,paddingRight:null,paddingBlock:null,paddingTop:null,paddingBottom:null,backgroundColor:"x12peec7",position:"x1n2onr6",$$css:!0},Ie={display:"x78zum5",width:"xh8yej3",gap:"x883omv",rowGap:null,columnGap:null,$$css:!0},Te=e=>{const n=S("div",fe),t=S("div",ve);t.history=le.init(`${e.key}/${e.type}`,(n=>N(n,t,e)));const l=S("div",we),o=S("div",Se,"modAI Assistant"),r=S("div",Re),i=k("✕",(()=>oe(t)),ke);r.append(i),l.append(o,r);const d=S("div",Ce),a=S("div",Ee),c=S("div",Ie),p=((e,n)=>{const t=S("div",be),l=S("textarea",he);l.placeholder="How can modAI help you today?",l.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation(),l.style.borderColor="#00B6DE"})),l.addEventListener("dragleave",(e=>{e.preventDefault(),e.stopPropagation(),l.style.borderColor="#e2e8f0"})),l.addEventListener("drop",(async n=>{n.preventDefault(),n.stopPropagation(),l.style.borderColor="#e2e8f0";let t=null,o=null;const r=n.dataTransfer;if(!r)return;const i=r.files;if(i?.length>0){const e=i[0];e.type.startsWith("image/")&&(t=e)}if(!t){const e=r.getData("text/uri-list");e&&(o=e)}if(t)await Z(e,t);else if(o){const n=new URL(window.location.href);if(!o.startsWith(n.origin))return void await Z(e,o,!0);try{const n=await fetch(o);if(n.ok){const t=await n.blob();if(t.type.startsWith("image/")){const n=new File([t],"image.png",{type:t.type});await Z(e,n)}}}catch{H(e,"Failed to fetch an image")}}else H(e,"Only image files are allowed")})),l.addEventListener("paste",(async n=>{const t=n.clipboardData?.items;if(t)for(let l=0;l<t.length;l++)if(-1!==t[l].type.indexOf("image")){const o=t[l].getAsFile();if(o){n.preventDefault(),await Z(e,o);break}}})),l.addEventListener("keydown",(t=>{if("Enter"===t.key){if(t.shiftKey)return;t.preventDefault(),re(e,n)}}));const o=S("div",me,[S("div",ye,[S("div",xe),S("div",xe),S("div",xe)])]);return t.append(l),t.append(o),e.messageInput=l,e.loadingIndicator=o,t})(t,e),g=((e,n)=>{const t=k([S("span",ce),"Send"],(()=>re(e,n)),ue),l=k(S("span",pe),(()=>(e=>{e.isLoading&&e.abortController&&(e.abortController.abort(),e.abortController=void 0,K(e,!1))})(e)),se,{title:"Stop Generation"});l.disable();const o=k(S("span",ge),(()=>((e,n)=>{if(0!==e.history.getMessages().length)if("text"!==n.type){if("image"===n.type){const t=e.history.getMessages().reverse().find((e=>"user"===e.role));t&&re(e,n,t.content)}}else re(e,n,"Try again")})(e,n)),se,{title:"Try Again"}),r=S("div",de),i=S("div",ae);return i.append(l,o),r.append(t,i),e.sendBtn=t,e.tryAgainBtn=o,e.stopBtn=l,r})(t,e);c.append(p,g),a.append(c),t.append(l,d,a);const b=((e,n)=>{const t=S("div",ie.modalFooter),l=S("div",ie.typeSelector),o=S("div",ie.typeLabel,"Generate:"),r=S("div",ie.typeToggleGroup),i={};(n.availableTypes??[]).forEach((t=>{const l=S("button",ie.typeToggleButton,t.charAt(0).toUpperCase()+t.slice(1));t===n.type&&(w(l,[ie.typeToggleButton,ie.typeToggleButtonActive]),l.disabled=!0),l.addEventListener("click",(()=>{t!==n.type&&(Object.values(i).forEach((e=>{w(e,ie.typeToggleButton),e.disabled=!1})),w(l,[ie.typeToggleButton,ie.typeToggleButtonActive]),l.disabled=!0,((e,n,t)=>{for(t.type=e,n.history=le.init(`${t.key}/${t.type}`,(e=>N(e,n,t)));n.chatMessages.firstChild;)n.chatMessages.removeChild(n.chatMessages.firstChild);n.chatMessages.style.display="none";const l=n.history.getMessages().filter((e=>!e.hidden));l.length>0?(n.chatMessages.style.display="block",l.forEach((e=>{N(e,n,t)})),n.tryAgainBtn.enable(),n.clearChatBtn.enable()):(n.tryAgainBtn.disable(),n.clearChatBtn.disable())})(t,e,n))})),i[t]=l,r.appendChild(l)})),l.append(o,r);const d=k("Clear Chat",(()=>(e=>{for(;e.chatMessages.firstChild;)e.chatMessages.removeChild(e.chatMessages.firstChild);e.chatMessages.style.display="none",e.history.clearHistory(),e.tryAgainBtn.disable(),e.clearChatBtn.disable()})(e)),ie.button);return t.append(l),t.append(d),e.clearChatBtn=d,e.typeSelector=l,e.typeButtons=i,t})(t,e);return t.append(b),e.overlay&&document.body.append(n),document.body.append(t),0===t.history.getMessages().length&&(t.clearChatBtn.disable(),t.tryAgainBtn.disable()),l.addEventListener("mousedown",(e=>((e,n)=>{n.isDragging=!0;const t=n.getBoundingClientRect();n.offsetX=e.clientX-t.left,n.offsetY=e.clientY-t.top,document.body.style.userSelect="none"})(e,t))),document.addEventListener("mousemove",(e=>s(e,t))),document.addEventListener("mouseup",(()=>u(t))),t.modalOverlay=n,t.chatHeader=l,t.closeBtn=i,t.chatMessages=d,t.inputWrapper=p,t.isDragging=!1,t.isLoading=!1,t.abortController=void 0,t.offsetX=0,t.offsetY=0,t},Be=["text","image"],$e=(e,n={})=>{const t={indicatorType:n.indicatorType||"spinner",overlayColor:n.overlayColor||"rgba(255, 255, 255, 0.7)",indicatorColor:n.indicatorColor||"#3498db"},l=document.createElement("div"),o=document.createElement("div"),r=window.getComputedStyle(e),i=e.getBoundingClientRect();n.indicatorColor||(t.indicatorType=i.height<=50?"dots":"spinner"),l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.width="100%",l.style.height="100%",l.style.backgroundColor=t.overlayColor,l.style.display="flex",l.style.justifyContent="center",l.style.alignItems="center",l.style.zIndex="10000",l.style.borderRadius=r.borderRadius;let d="";if("spinner"===t.indicatorType)o.style.border="4px solid #f3f3f3",o.style.borderTop=`4px solid ${t.indicatorColor}`,o.style.borderRadius="50%",o.style.width="30px",o.style.height="30px",o.style.animation="textareaOverlaySpin 1s linear infinite",d="\n      @keyframes textareaOverlaySpin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n      }\n    ";else if("dots"===t.indicatorType){o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="center",o.style.height="20px";for(let e=0;e<3;e++){const n=document.createElement("div");n.style.width="8px",n.style.height="8px",n.style.borderRadius="50%",n.style.backgroundColor=t.indicatorColor,n.style.margin="0 4px",n.style.animation="textareaOverlayDotPulse 1.4s infinite ease-in-out",n.style.animationDelay=.2*e+"s",o.appendChild(n)}d="\n      @keyframes textareaOverlayDotPulse {\n        0%, 80%, 100% { transform: scale(0); opacity: 0.5; }\n        40% { transform: scale(1); opacity: 1; }\n      }\n    "}const a=document.createElement("style");a.textContent=d,document.head.appendChild(a),l.appendChild(o);const s=window.getComputedStyle(e.parentElement);let u;-1===["relative","absolute","fixed"].indexOf(s.position)?(u=document.createElement("div"),u.style.position="relative",u.style.width=`${i.width}px`,u.style.height=`${i.height}px`,u.style.display="inline-block",e.parentNode?.insertBefore(u,e),u.appendChild(e)):u=e.parentElement,l.style.display="none",u.appendChild(l);const c=e.getBoundingClientRect();return u!==e.parentElement&&(u.style.width=`${c.width}px`,u.style.height=`${c.height}px`),l.style.display="flex",e.setAttribute("disabled","disabled"),()=>{l.style.display="none",e.removeAttribute("disabled"),l.remove(),a.remove(),u!==e.parentElement&&(u.parentNode?.insertBefore(e,u),u.remove())}},Le={createLoadingOverlay:$e,localChat:e=>(e=>{if(Y.modalOpen)return;if(!e.key)return void alert("key is required config property");void 0===e.overlay&&(e.overlay=!0),e.type||(e.type="text"),e.availableTypes||(e.availableTypes=[e.type]),e.availableTypes=e.availableTypes.filter((e=>Be.includes(e))),e.availableTypes.length>0&&!e.availableTypes.includes(e.type)&&e.availableTypes.unshift(e.type);const n=Te(e);return n.api={sendMessage:async(t,l)=>{await re(n,e,t,l)},closeModal:()=>{oe(n)}},((e,n)=>{e.chatMessages.innerHTML="",e.chatMessages.style.display="none",e.style.visibility="hidden",e.style.display="flex",e.modalOverlay.style.display="block";const t=e.history.getMessages().filter((e=>!e.hidden));t.length>0&&(e.chatMessages.style.display="block",t.forEach((t=>{N(t,e,n)}))),setTimeout((()=>{e.chatMessages.scrollTop=e.chatMessages.scrollHeight,e.style.visibility="visible"}),100)})(n,e),Y.modalOpen=!0,n})(e),generateButton:()=>{}},je=(e,n)=>{e.context.els.forEach((({wrapper:t,field:l})=>{const o=l.getValue();l.setValue(e.value),l.fireEvent("change",l,e.value,o),n&&(l.el.dom.scrollTop=l.el.dom.scrollHeight),e.total>0&&t.historyNav.show(),t.historyNav.info.update(e.current,e.total),e.prevStatus?t.historyNav.prevButton.enable():t.historyNav.prevButton.disable(),e.nextStatus?t.historyNav.nextButton.enable():t.historyNav.nextButton.disable()}))},We=()=>{const e=document.createElement("button");return e.className="modai-generate",e.innerText="✦",e.type="button",e.title="Generate using AI",e},ze=e=>{const n=document.createElement("button");n.type="button",n.title="Previous Version",n.className="modai-history_prev",n.disable=()=>{n.disabled=!0},n.enable=()=>{n.disabled=!1},n.innerHTML="prev",n.addEventListener("click",(()=>{e.prev()}));const t=document.createElement("button");t.type="button",t.title="Next Version",t.className="modai-history_next",t.disable=()=>{t.disabled=!0},t.enable=()=>{t.disabled=!1},t.innerHTML="next",t.addEventListener("click",(()=>{e.next()}));const l=document.createElement("span");l.update=(e,n)=>{l.innerText=`${e}/${n}`},l.innerText="";const o=document.createElement("span");return o.show=()=>{o.style.display="initial"},o.hide=()=>{o.style.display="none"},o.prevButton=n,o.nextButton=t,o.info=l,o.appendChild(n),o.appendChild(t),o.appendChild(l),o.hide(),n.disable(),t.disable(),o},Me=e=>{const n=We();return n.addEventListener("click",(()=>{Le.localChat({key:e,field:e,overlay:!1,type:"text",availableTypes:["text","image"],resource:MODx.request.id})})),n},qe=(e,n)=>{const t=document.createElement("span"),l=We();l.addEventListener("click",(async()=>{const t=$e(e.el.dom);try{const e=await i.mgr.prompt.text({id:MODx.request.id,field:n});o.insert(e.content),t()}catch(e){t(),Ext.Msg.alert("Failed",_("modai.cmp.failed_try_again",{msg:e instanceof Error?e.message:""}))}})),t.appendChild(l);const o=a.init(n,je,e.getValue(),{});o.cachedItem.context.els||(o.cachedItem.context.els=[]),o.cachedItem.context.els.push({field:e,wrapper:t});const r=ze(o);return t.appendChild(r),t.historyNav=r,t},Ae=(e,n,t)=>{const l=We();return l.addEventListener("click",(()=>{Le.localChat({key:n,field:n,type:"image",resource:MODx.request.id,image:{mediaSource:parseInt(e)||void 0},imageActions:{copy:!1,insert:(e,n)=>{t(e),n.api.closeModal()}}})})),l},_e=(e,n)=>{const t=Ext.getCmp(e);if(!t)return;const l=document.createElement("span"),o=We();o.addEventListener("click",(async()=>{const e=$e(t.el.dom);try{const t=await i.mgr.prompt.text({id:MODx.request.id,field:n},(e=>{r.insert(e.content,!0)}));r.insert(t.content),e()}catch(n){e(),Ext.Msg.alert("Failed",_("modai.cmp.failed_try_again",{msg:n instanceof Error?n.message:""}))}})),l.appendChild(o);const r=a.init(n,je,t.getValue(),{});r.cachedItem.context.els||(r.cachedItem.context.els=[]),r.cachedItem.context.els.push({field:t,wrapper:l});const d=ze(r);l.appendChild(d),l.historyNav=d,t.label.appendChild(l)},De=(e,n)=>{const t=Ext.getCmp(e.firstElementChild?.id),l=Ae(t.imageBrowser.source,n,(function(e){t.imageBrowser.setValue(e.ctx.url),t.onImageChange(e.ctx.url)})),o=We();o.style.marginTop="6px",o.addEventListener("click",(async()=>{const e=t.imagePreview.el.dom,l=document.createElement("canvas"),o=l.getContext("2d");if(!o)return;l.width=e.width,l.height=e.height,o.drawImage(e,0,0);const r=l.toDataURL("image/png"),d=$e(t.altTextField.items.items[0].el.dom);try{const e=await i.mgr.prompt.vision({image:r,field:n},(e=>{t.altTextField.items.items[0].setValue(e.content),t.altTextField.items.items[0].el.dom.scrollTop=t.altTextField.items.items[0].el.dom.scrollHeight,t.image.altTag=e.content,t.updateValue()}));t.altTextField.items.items[0].setValue(e.content),t.image.altTag=e.content,t.updateValue(),d()}catch(e){d(),Ext.Msg.alert("Failed",_("modai.cmp.failed_try_again",{msg:e instanceof Error?e.message:""}))}})),t.altTextField.el.dom.style.display="flex",t.altTextField.el.dom.style.justifyItems="center",t.altTextField.el.dom.style.alignItems="center",t.el.dom.parentElement?.parentElement?.parentElement?.querySelector("label")?.appendChild(l),t.altTextField.el.dom.appendChild(o)},Oe=()=>{const e=Ext.getCmp("modx-resource-content").el.dom.querySelector("label");e?.appendChild(Me("res.content"))};Ext.onReady((function(){Ext.defer((function(){(()=>{const e={pagetitle:["modx-resource-pagetitle"],longtitle:["modx-resource-longtitle","seosuite-longtitle"],introtext:["modx-resource-introtext"],description:["modx-resource-description","seosuite-description"],content:["modx-resource-content"]};for(const n of modAI?.resourceFields||[])e[n]&&("content"!==n?e[n].forEach((e=>{_e(e,`res.${n}`)})):Oe())})(),(()=>{const e=Ext.getCmp("modx-panel-resource").getForm();for(const[n,t]of modAI?.tvs||[]){const l=Ext.get(`tv${n}-tr`);if(!l)continue;const o=e.findField(`tv${n}`),r=`tv.${t}`;if(o){if("textfield"===o.xtype||"textarea"===o.xtype){const e=MODx.config[`modai.tv.${t}.text.prompt`],n=l.dom.querySelector("label");if(!n)return;e?n.appendChild(qe(o,r)):n.appendChild(Me(r))}if("modx-panel-tv-image"===o.xtype){const e=Ae(o.source,r,(function(e){const n={relativeUrl:e.ctx.url,url:e.ctx.url};o.items.items[1].fireEvent("select",n),o.fireEvent("select",n)})),n=l.dom.querySelector("label");if(!n)return;n.appendChild(e)}}else{const e=l.dom.querySelector(".imageplus-panel-input");e&&De(e,r)}}})()}),500)}));const Pe={};return n})()));